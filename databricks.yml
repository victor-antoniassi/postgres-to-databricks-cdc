# This is a Databricks asset bundle definition.
# See https://docs.databricks.com/dev-tools/bundles/index.html for documentation.
bundle:
  name: postgres_to_databricks_cdc
  uuid: 5d1e8c7c-4a3b-4e0f-9d2a-7b8f9e6a2c3d

include:
  - resources/jobs/*.job.yml

# Defines how Python code is packaged.
# For this project, we use the wheel format, which is the recommended approach
# for packaging Python code for execution in Databricks Jobs.
artifacts:
  postgres_cdc_wheel:
    type: whl
    build: uv build --wheel

# Variables that can be used in jobs and pipelines.
variables:
  catalog:
    description: The Unity Catalog to use for tables.
  schema:
    description: The schema within the Unity Catalog to use.

targets:
  dev:
    # The default target uses 'mode: development' to create a development copy.
    # - Deployed resources are prefixed with '[dev your_username]'
    # - Any job schedules are paused by default.
    mode: development
    default: true
    workspace:
      host: https://dbc-2b79b085-f261.cloud.databricks.com
    variables:
      catalog: dev_chinook_lakehouse
      schema: bronze

  qa:
    # QA target mimics production but writes to a separate schema
    mode: production
    workspace:
      host: https://dbc-2b79b085-f261.cloud.databricks.com
      root_path: /Shared/qa/${bundle.name}
    variables:
      catalog: qa_chinook_lakehouse
      schema: bronze

  prod:
    mode: production
    workspace:
      host: https://dbc-2b79b085-f261.cloud.databricks.com
      root_path: /Shared/prod/${bundle.name}
    variables:
      catalog: prod_chinook_lakehouse
      schema: bronze
    # Example permissions for the production environment.
    permissions:
      - user_name: victor@antoniassi.xyz
        level: CAN_MANAGE
